import streamlit as st
import openai

# Streamlitã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¨­å®š
st.set_page_config(
    page_title="SEOè¨˜äº‹æ§‹æˆæ¡ˆä½œæˆ",
    page_icon="ğŸ¹",
    layout="wide"
)

with st.form("my_form"):
    api_key = st.text_input("OpenAI APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", type="password")
    
    st.subheader("å¯¾ç­–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ï¼ˆ1ã€œ3å€‹ï¼‰")
    keywords = [st.text_input(f"å¯¾ç­–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ {i+1}") for i in range(3)]
    keywords = [k for k in keywords if k]  # ç©ºã®å…¥åŠ›ã‚’é™¤å¤–
    
    st.subheader("ç«¶åˆè¨˜äº‹ã®å…¥åŠ›ï¼ˆ3è¨˜äº‹åˆ†ï¼‰")
    articles = []
    for i in range(3):
        title = st.text_input(f"ç«¶åˆè¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ« {i+1}")
        description = st.text_area(f"ç«¶åˆè¨˜äº‹ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ {i+1}", height=100)
        if title and description:
            articles.append(f"{title}ï¼š{description}")
    
    # top_pã®å€¤ã‚’ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§é¸æŠ
    st.subheader("è¨­å®š")
    top_p_value = st.slider("top_pã®å€¤", min_value=0.0, max_value=1.0, value=0.2, step=0.1)
    st.caption("top_pã¯å‡ºåŠ›çµæœã®å¤šæ§˜æ€§ã‚’åˆ¶å¾¡ã™ã‚‹å€¤ã§ã€0ã«è¿‘ã„ã»ã©ä¸€è²«æ€§ãŒé«˜ãã€1ã«è¿‘ã„ã»ã©å¤šæ§˜æ€§ãŒå¢—ã—ã¾ã™")
    
    top_p_value = st.slider("å‡ºåŠ›çµæœã®æ•°", min_value=1, max_value=10, value=3, step=1)
    st.caption("å‡ºåŠ›ã™ã‚‹æ§‹æˆæ¡ˆã®æ•°ã‚’æŒ‡å®šã—ã¾ã™")
    
    
    submit_button = st.form_submit_button("ç”Ÿæˆã™ã‚‹")

if submit_button and api_key and articles:
    prompt = """SEOå°‚é–€å®¶ã¨ã—ã¦ã€ç«¶åˆè¨˜äº‹ã‚ˆã‚Šã‚‚æ¤œç´¢çµæœã§ä¸Šä½ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ãªè¨˜äº‹ã®æ§‹æˆæ¡ˆã‚’è€ƒãˆã¦ãã ã•ã„ã€‚
- ä¸‹è¨˜ã®æƒ…å ±ã‚’è¸ã¾ãˆã¦ã€è¨˜äº‹ã®æ§‹æˆæ¡ˆã¯â‘ ã‚¿ã‚¤ãƒˆãƒ«ã€â‘¡è¨˜äº‹ã®æ¦‚è¦ã€â‘¢ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã®æ¤œç´¢æ„å›³ã€â‘£ç«¶åˆè¨˜äº‹ã¨ã®å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆã€â‘¤è¦‹å‡ºã—ï¼ˆè¦‹å‡ºã—ã®èª¬æ˜ï¼‰ã®é …ç›®ã§ä½œæˆã™ã‚‹ã“ã¨ã€‚
- æ˜ç¢ºãªã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†ã‘ã€h2/h3è¦‹å‡ºã—ã®è¨­å®šã™ã‚‹ã“ã¨ã€‚
- h2ã¯3ã€œ5å€‹ã€h3ã¯2ã€œ4å€‹ã§è¨­å®šã™ã‚‹ã“ã¨ã€‚
- ç«¶åˆè¨˜äº‹ã®æƒ…å ±ã‚’åˆ†æã—ã€ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã®æ¤œç´¢æ„å›³ãƒ»ç«¶åˆè¨˜äº‹ã¨ã®å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹ã“ã¨ã€‚
- ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«å¾“ã„ä½œæˆã™ã‚‹ã“ã¨ã€‚
- å¯¾ç­–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¦‹å‡ºã—ã«é©åˆ‡ã«å«ã‚ã‚‹ã“ã¨ã€‚
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã«ã¨ã£ã¦æœ‰ç›Šã§ã€èˆˆå‘³æ·±ã„å†…å®¹ã‚’æä¾›ã™ã‚‹ã“ã¨ã€‚
- ãƒ“ã‚¸ãƒã‚¹ãƒ©ã‚¤ã‚¯ãªãƒˆãƒ¼ãƒ³ã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã€‚

## å¯¾ç­–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
- {keyword1}
- {keyword2}
- {keyword3}

## ç«¶åˆè¨˜äº‹
- {article_title1}ï¼š{article_description1}
- {article_title2}ï¼š{article_description2}
- {article_title3}ï¼š{article_description3}

## ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹
- å¤§ä¼æ¥­ã«æ‰€å±ã™ã‚‹ç¤¾ä¼šäºº
- 20ä»£å¾ŒåŠã€œ40ä»£ã®ä¸­é–“ç®¡ç†è·ã‚„ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚¯ãƒ©ã‚¹
- æ‰€å±ä¼æ¥­ã®ã‚¤ãƒ™ãƒ³ãƒˆã«é–¢ã‚ã£ã¦ã„ã‚‹

## ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- ã‚¿ã‚¤ãƒˆãƒ«ã«ã¯å¿…ãšå¯¾ç­–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã¿ã€ãªã‚‹ã¹ãå¯¾ç­–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å‰åŠã«å…¥ã‚Œã¦ãã ã•ã„ã€‚
- è¨˜äº‹ã®æ¦‚è¦ã«ã¯ã€ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã“ã¨ã§ã©ã®ã‚ˆã†ãªæƒ…å ±ãŒå¾—ã‚‰ã‚Œã‚‹ã‹ã‚’ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚
- ãã‚Œãã‚Œã®è¦‹å‡ºã—ã«ã¯ã€ã©ã®ã‚ˆã†ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ›¸ãã¹ãã‹ãŒã‚ã‹ã‚‹è¦‹å‡ºã—ã®èª¬æ˜ã‚’ã¤ã‘ã¦ãã ã•ã„ã€‚
- è¨˜äº‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯2500æ–‡å­—ã€œ3000æ–‡å­—ã‚’æƒ³å®šã—ã¦ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯1è¦‹å‡ºã—ã«éå‰°ã«è©°ã‚è¾¼ã¾ãšã€è‡ªç„¶ãªè¦‹å‡ºã—ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
- è¦‹å‡ºã—ã®ä¸€ç•ªæœ€å¾Œã«ã¯ã¾ã¨ã‚è¦‹å‡ºã—ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚ã¾ã¨ã‚è¦‹å‡ºã—ã§ã¯H3è¦‹å‡ºã—ã‚’ä½œæˆã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- æœ‰è³‡æ ¼è€…ã‚„å°‚é–€å®¶ã®çŸ¥è¦‹ãŒå¿…è¦ãªå†…å®¹ã¯å«ã¾ãªã„ã§ãã ã•ã„ã€‚
- å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§æŒ‡å®šã•ã‚Œã¦ã„ã‚‹é …ç›®ä»¥å¤–ã®å†…å®¹ã‚’å‡ºåŠ›ã—ã¦ã¯ã„ã‘ãªã„ã€‚

## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### ã‚¿ã‚¤ãƒˆãƒ«
### è¨˜äº‹ã®æ¦‚è¦
### ã‚ªãƒ¼ãƒ‡ã‚£ã‚¨ãƒ³ã‚¹ã®æ¤œç´¢æ„å›³
### ç«¶åˆè¨˜äº‹ã¨ã®å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ
### è¦‹å‡ºã—
- h2ï¼š
    - h2ã®èª¬æ˜ï¼š
- h3ï¼š 
    - h3ã®èª¬æ˜ï¼š
    """.format(
        keyword1=keywords[0], 
        keyword2=keywords[1] if len(keywords) > 1 else "", 
        keyword3=keywords[2] if len(keywords) > 2 else "", 
        article_title1=articles[0].split("ï¼š")[0], 
        article_description1=articles[0].split("ï¼š")[1],
        article_title2=articles[1].split("ï¼š")[0], 
        article_description2=articles[1].split("ï¼š")[1],
        article_title3=articles[2].split("ï¼š")[0], 
        article_description3=articles[2].split("ï¼š")[1]
    )
    
    for i in range(3):  
        # ChatGPT APIã‚’å‘¼ã³å‡ºã—
        response = openai.ChatCompletion.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            max_tokens=3000,
            temperature=1,
            top_p=top_p_value,
            api_key=api_key
        )
        
        st.text_area(f"ç”Ÿæˆã•ã‚ŒãŸè¨˜äº‹ã®æ§‹æˆæ¡ˆ{i+1}", response.choices[0].message['content'], height=500)